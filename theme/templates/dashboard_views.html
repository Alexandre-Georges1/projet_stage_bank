<!-- Toutes les vues du dashboard -->
{% load static %}
<!-- Vue Tableau de Bord -->
<div id="dashboard-view" class="hidden">
    <h1>Tableau de Bord</h1>
    <ul class="dashboard-cards">
        <li class="dashboard-card type-stock">
            <i class="fas fa-desktop"></i>
            <span class="text">
                <h3>{{ pc_total }}</h3>
                <p>Disponibles</p>
            </span>
        </li>
        <li class="dashboard-card type-rebut">
            <i class="fa-solid fa-laptop"></i>
            <span class="text">
                <h3>{{ pc_en_rebu }}</h3>
                <p>Mis en rebut</p>
            </span>
        </li>
        <li class="dashboard-card type-rebut-attr">
            <i class="fa-solid fa-laptop"></i>
            <span class="text">
                <h3>{{ pc_en_rebu_attribue }}</h3>
                <p>En rebut attribués</p>
            </span>
        </li>
        <li class="dashboard-card type-service">
            <i class="fas fa-desktop"></i>
            <span class="text">
                <h3>{{ pc_en_service }}</h3>
                <p>En service</p>
            </span>
        </li>
        <li class="dashboard-card type-total">
            <i class="fas fa-desktop"></i>
            <span class="text">
                <h3>{{ pc_total_global }}</h3>
                <p>Total des ordinateurs</p>
            </span>
        </li>
    </ul>
</div>

<div id="parametre-view" class="hidden">
    <div class="bg-white shadow-sm border-b">
        <div class="parametres-container">
            <h2 class="text-3xl font-bold text-gray-900 py-4">Paramètres</h2>
        </div>
    </div>
    <div class="parametres-container">
        <div id="alertContainer"></div>
        
        <form id="parametresForm" method="post">
            {%csrf_token%}
            <!-- Conteneur flex pour les deux blocs côte à côte -->
            <div class="flex flex-row gap-6" style="display: flex; flex-direction: row; gap: 30px; width: 100%;">
                <!-- Bloc Marques -->
                <div class="gestion-box flex-1">
                    <h2 class="text-xl font-semibold mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-house-laptop"></i> Gérer les Marques
                    </h2>
                    
                    <!-- Input + bouton -->
                    <div class="flex items-center gap-4 mb-4">
                        <input type="text" id="inputMarque" placeholder="Ajouter une marque"
                               class="border rounded p-2 flex-1 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        <button aria-label="Ajouter une marque" type="button" onclick="ajouterMarque()"
                                class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors">
                            Ajouter
                        </button>
                    </div>
                    
                    <!-- Tableau des marques -->
                    <div class="overflow-x-auto">
                        <table class="w-full border text-left">
                            <thead class="bg-gray-200">
                                <tr>    
                                    <th class="p-2">N°</th>     
                                    <th class="p-2">Marque</th>
                                    <th class="p-2">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tableMarques">
                                <!-- Les marques seront ajoutées ici dynamiquement -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Bloc Modèles -->
                <div class="gestion-box flex-1">
                    <h2 class="text-xl font-semibold mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-laptop"></i> Gérer les Modèles
                    </h2>
                    
                    <!-- Input + bouton -->
                    <div class="flex items-center gap-4 mb-4">
                        <input type="text" id="inputModele" placeholder="Ajouter un modèle"
                               class="border rounded p-2 flex-1 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        <button aria-label="Ajouter un modèle" type="button" onclick="ajouterModele()"
                                class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors">
                            Ajouter
                        </button>
                    </div>
                    
                    <!-- Tableau des modèles -->
                    <div class="overflow-x-auto">
                        <table class="w-full border text-left">
                            <thead class="bg-gray-200">
                                <tr>
                                    <th class="p-2">N°</th> 
                                    <th class="p-2">Modèle</th>
                                    <th class="p-2">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tableModeles">
                                <!-- Les modèles seront ajoutés ici dynamiquement -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Vue Inventaire -->
<div id="catalogue-view" class="hidden">
    <div class="flex justify-between items-center mb-8">
        <h2>Inventaire des ordinateurs</h2>
        <button aria-label="Ajouter un nouveau PC" id="new-user-btn" class="btn-ajouter-manuel">
            Ajouter ordinateur
        </button>
    </div>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Les ordinateurs</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th style="width: 12%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600; background-color: #f8f9fa;">Marque</th>
                        <th style="width: 12%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600; background-color: #f8f9fa;">Modèle</th>
                        <th style="width: 15%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600; background-color: #f8f9fa;">Processeur</th>
                        <th style="width: 8%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600; background-color: #f8f9fa;">RAM</th>
                        <th style="width: 10%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600; background-color: #f8f9fa;">Disque</th>
                        <th style="width: 15%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600; background-color: #f8f9fa;">N° de série</th>
                        <th style="width: 12%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600; background-color: #f8f9fa;">Date d'achat</th>
                        <th style="width: 16%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600; background-color: #f8f9fa;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pc in pcs %}
                    <tr data-pc-id="{{ pc.pk }}" style="border-bottom: 1px solid #f0f0f0;">
                        <td style="padding: 16px 8px; vertical-align: middle; font-weight: 500;">{{ pc.marque }}</td>
                        <td style="padding: 16px 8px; vertical-align: middle;">{{ pc.modele }}</td>
                        <td style="padding: 16px 8px; vertical-align: middle; font-size: 14px;">{{ pc.processeur }}</td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle; font-weight: 500;">{{ pc.ram }}</td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle;">{{ pc.disque_dur }}</td>
                        <td style="padding: 16px 8px; vertical-align: middle; font-family: monospace; font-size: 13px;">{{ pc.numero_serie }}</td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle;">{{ pc.date_achat|date:"d/m/Y" }}</td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle;">
                            <button class="btn-modifier" aria-label="Modifier" style="margin: 0 2px;"><i class="fas fa-edit"></i></button>
                            <button class="btn-supprimer" aria-label="Supprimer" style="margin: 0 2px;"><i class="fas fa-trash-alt"></i></button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Vue Inventaire Ancien -->
<div id="catalogue-ancien-view" class="hidden">
    <h2>Inventaire Ancien</h2>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Ordinateurs archivés</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>
            <!-- Actions Pc_ancien: amortir / ajouter / attribuer -->
            <div class="flex items-center gap-3 mb-8" style="display:flex; align-items:center; gap:10px; margin-bottom:20px;">
                <button aria-label="Amortir maintenant" id="btn-amortir-maintenant" class="btn-ajouter-manuel" data-url="{% url 'amortir_pcs' %}">
                    <i class="fas fa-history"></i> Amortir maintenant
                </button>
                <button aria-label="Ajouter un PC ancien" id="btn-ajouter-pc-ancien" class="btn-ajouter-manuel">
                    <i class="fas fa-box-archive"></i> Ajouter un ordinateur ancien
                </button>
                <button aria-label="Attribuer un PC ancien" id="btn-assigner-pc-ancien" class="btn-ajouter-manuel">
                    <i class="fas fa-user-check"></i> Attribuer ordinateur mis en rebut
                </button>
                <span id="amortirResult" style="margin-left:10px; font-size:14px; color:#555;"></span>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Marque</th>
                        <th>Modèle</th>
                        <th>Processeur</th>
                        <th>RAM</th>
                        <th>Disque</th>
                        <th>Numéro de série</th>
                        <th>Date d'achat</th>
                        <th>Employé</th>
                        <th>Date d'archivage</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pc_arch in pcs_anciens %}
                    <tr data-ancien-id="{{ pc_arch.id_ancien }}"
                        {% if pc_arch.employe %}data-employe-id="{{ pc_arch.employe.id_employe }}"{% endif %}
                        {% if pc_arch.date_achat %}data-date-achat="{{ pc_arch.date_achat|date:'Y-m-d' }}"{% endif %}>
                        <td>{{ pc_arch.marque }}</td>
                        <td>{{ pc_arch.modele }}</td>
                        <td>{{ pc_arch.processeur }}</td>
                        <td>{{ pc_arch.ram }}</td>
                        <td>{{ pc_arch.disque_dur }}</td>
                        <td>{{ pc_arch.numero_serie }}</td>
                        <td>{{ pc_arch.date_achat|date:"Y-m-d" }}</td>
                        <td>{% if pc_arch.employe %}{{ pc_arch.employe.nom }} {{ pc_arch.employe.prenom }}{% else %}-{% endif %}</td>
                        <td>{{ pc_arch.date_ajout|date:"Y-m-d" }}</td>
                        <td>
                            <button class="btn-modifier" title="Modifier" style="margin: 0 2px;"><i class="fas fa-edit"></i></button>
                            <button class="btn-supprimer" title="Supprimer" style="margin: 0 2px;"><i class="fas fa-trash-alt"></i></button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="9">Aucun ordinateur archivé.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Ordinateurs en rebut attribués</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Marque</th>
                        <th>Modèle</th>
                        <th>N° de série</th>
                        <th>Employé</th>
                        <th>Date d'attribution</th>
                        <th>Date fin d'attribution</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for a in pcs_anciens_attribues %}
                    <tr data-ancien-attribue-id="{{ a.id_attribue_ancien }}"
                        {% if a.employe %}data-employe-id="{{ a.employe.id_employe }}"{% endif %}
                        data-date-attr="{{ a.date_attribution|date:'Y-m-d' }}"
                        {% if a.date_fin_attribution %}data-date-fin="{{ a.date_fin_attribution|date:'Y-m-d' }}"{% endif %}>
                        <td>{{ a.marque }}</td>
                        <td>{{ a.modele }}</td>
                        <td>{{ a.numero_serie }}</td>
                        <td>{% if a.employe %}{{ a.employe.nom }} {{ a.employe.prenom }}{% else %}-{% endif %}</td>
                        <td>{{ a.date_attribution|date:"Y-m-d" }}</td>
                        <td>{{ a.date_fin_attribution|date:"Y-m-d" }}</td>
                        <td>
                            <button class="btn-modifier" aria-label="Modifier" title="Modifier" style="margin: 0 2px;"><i class="fas fa-edit"></i></button>
                            <button class="btn-supprimer" aria-label="Supprimer" title="Supprimer" style="margin: 0 2px;"><i class="fas fa-trash-alt"></i></button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="6">Aucune attribution d'ordinateur ancien.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
</div>


<!-- Vue Utilisateurs -->
<div id="utilisateur-view" class="hidden">
    <div class="flex justify-between items-center mb-8">
        <h2>Utilisateurs</h2>
        <button aria-label="Ouvrir le formulaire d'ajout d'utilisateur" id="add-user-btn" class="btn-ajouter-manuel" aria-label="Ajouter Utilisateur">
            <i class="fas fa-plus"></i>
            Ajouter Utilisateur
        </button>
    </div> 
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Tous les utilisateurs</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #f8f9fa;">
                        <th style="width: 10%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Nom</th>
                        <th style="width: 10%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Prénom</th>
                        <th style="width: 10%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Login</th>
                        <th style="width: 8%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Mot de passe</th>
                        <th style="width: 8%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Matricule</th>
                        <th style="width: 10%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Téléphone</th>
                        <th style="width: 15%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Email</th>
                        <th style="width: 10%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Département</th>
                        <th style="width: 9%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Date embauche</th>
                        <th style="width: 10%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Fonction</th>
                        <th style="width: 10%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for employe in employes %}
                    <tr data-user-id="{{ employe.pk }}" style="border-bottom: 1px solid #f0f0f0;">
                        <td style="padding: 16px 8px; vertical-align: middle; font-weight: 500;">{{ employe.nom }}</td>
                        <td style="padding: 16px 8px; vertical-align: middle; font-weight: 500;">{{ employe.prenom }}</td>
                        <td style="padding: 16px 8px; vertical-align: middle; color: #666;">{{ employe.login }}</td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle; color: #999;">******</td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle; font-family: monospace;">{{ employe.matricule }}</td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle;">{{ employe.telephone }}</td>
                        <td style="padding: 16px 8px; vertical-align: middle; color: #0066cc;">{{ employe.email }}</td>
                        <td style="padding: 16px 8px; vertical-align: middle;">{{ employe.Département }}</td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle;">{{ employe.date_embauche|date:"d/m/Y" }}</td>
                        <td style="padding: 16px 8px; vertical-align: middle;">{{ employe.fonction }}</td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle;">
                            <button class="btn-modifier" aria-label="Modifier" title="Modifier" style="margin: 0 2px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-supprimer" aria-label="Supprimer" title="Supprimer" style="margin: 0 2px;">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Vue Nouvel Employé -->
<div id="nouvel-employe-view" class="hidden">	
    <h2>Nouvel Employé</h2>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Informer un arrivé</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>
            <form id="nouvelEmployeForm" method="post">
                {% csrf_token %}
                <div class="form-group">
                    <label for="nouvelNom">Nom:</label>
                    <input type="text" id="nouvelNom" name="nom" required>
                </div>
                <div class="form-group">
                    <label for="nouvelPrenom">Prénom:</label>
                    <input type="text" id="nouvelPrenom" name="prenom" required>
                </div>
                <div class="form-group">
                    <label for="nouvelMatricule">Matricule:</label>
                    <input type="text" id="nouvelMatricule" name="matricule" required>
                </div>
                <div class="form-group">
                    <label for="nouvelTelephone">Téléphone:</label>
                    <input type="tel" id="nouvelTelephone" name="telephone" required>
                </div>
                <div class="form-group">
                    <label for="nouvelDépartement">Département:</label>
                    <input type="text" id="nouvelDepartement" name="département" required>
                </div>
                <div class="form-group">
                    <label for="nouvelDateEmbauche">Date d'embauche:</label>
                    <input type="date" id="nouvelDateEmbauche" name="dateEmbauche" required>
                </div>
                <div class="form-group">
                    <label for="nouvelFonction">Fonction:</label>
                    <input type="text" id="nouvelFonction" name="fonction" placeholder="Saisir la fonction" required>
                </div>
                <button aria-label="Informer l'arrivée" type="submit" class="btn-ajouter-manuel">Informer l'arrivée</button>
            </form>
        </div>
    </div>
</div>

<!-- Vue Demande de caractéristique -->
<div id="demande-view" class="hidden">
    <h2>Demande de caractéristique</h2>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Demander caractéristique</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>
            <form id="demandeCaracteristiqueForm">
                {% csrf_token %}
                <div class="form-group">
                    <label for="demandeEmploye">Sélectionner un employé:</label>
                    <select id="demandeEmploye" name="employe_id" required>
                        <option value="" disabled selected>Sélectionner un employé</option>
                        {% for employe in employes_sans_caracteristique %}
                        <option value="{{ employe.pk }}">{{ employe.nom }} {{ employe.prenom }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="caracteristiqueDemande">Objet de la demande:</label>
                    <select id="caracteristiqueDemande" name="caracteristique" required disabled style="width: 100%; padding: 12px 15px; border: 1px solid #e0e0e0; border-radius: 8px; box-sizing: border-box; font-size: 16px; color: #333;">
                        <option value="Demande de caractéristique" selected>Demande de caractéristique</option>
                    </select>
                </div>
                <button aria-label="Faire la demande" type="submit" class="btn-ajouter-manuel">Demander</button>
            </form>
        </div>
    </div>
</div>

<!-- Vue Achat de périphérique -->
<div id="Achat_piece-view" class="hidden">
    <h1>Demande d'achat de périphérique</h1>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Faire une demande</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>
            <form id="demandeAchatPieceForm" method="post" action="{% url 'demande_achat_peripheriques' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="demandeAchatMateriel">Sélectionner le matériel </label>
                    <select id="demandeAchatMateriel" name="materiel" required>
                        <option value="" disabled selected>Sélectionner le matériel: </option>
                        <option value="Souris">Souris</option>
                        <option value="Clavier">Clavier</option>
                        <option value="Écran">Écran</option>
                        <option value="Imprimante">Imprimante</option>
                        <option value="Autre">Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="demandeAchatCaracteristique">Objet de la demande:</label>
                    <select id="demandeAchatCaracteristique" name="caracteristique" required disabled style="width: 100%; padding: 12px 15px; border: 1px solid #e0e0e0; border-radius: 8px; box-sizing: border-box; font-size: 16px; color: #333;">
                        <option value="Demande d'achat de périphérique" selected>Demande d'achat de périphérique</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="commentairesAchat">Commentaires additionnels (optionnel):</label>
                    <textarea id="commentairesAchat" name="commentaires" rows="6" style="width:100%; min-height:160px; padding:12px 14px; border:1px solid #d0d0d0; border-radius:8px; resize:vertical; font-size:14px; line-height:1.4;" placeholder="Précisez vos besoins ou ajoutez des informations complémentaires..."></textarea>
                </div>
                <button aria-label="Faire la demande" type="submit" class="btn-ajouter-manuel">Faire la demande</button>
            </form>
        </div>
    </div>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Historique de vos demandes</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Matériel</th>
                        <th>Date de la demande</th>
                        <th>Statut</th>
                    </tr>
                </thead>
                <tbody>
                    {% for demande in demandes_achat %}
                    <tr>
                        <td>{{ demande.materiel }}</td>
                        <td>{{ demande.date_demande|date:"d/m/Y H:i" }}</td>
                        <td>
                            <span class="{{ demande.get_statut_display_class }}">{{ demande.get_statut_display }}</span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="3">Aucune demande d'achat de périphérique.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Vue Validation des demandes d'achat de périphériques -->
<div id="Achat_piecevalider-view" class="hidden">
    <h2>Validation des Demandes d'Achat de Périphériques</h2>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Demandes en attente</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #f8f9fa;">
                        <th style="width: 20%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Employé</th>
                        <th style="width: 15%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Département</th>
                        <th style="width: 15%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Matériel demandé</th>
                        <th style="width: 12%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Date de demande</th>
                        <th style="width: 20%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Commentaires</th>
                        <th style="width: 18%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for demande in demandes_peripheriques_en_attente %}
                    <tr data-demande-id="{{ demande.id_demande }}" style="border-bottom: 1px solid #f0f0f0;">
                        <td style="padding: 34px 16px; vertical-align: middle; font-weight: 500;">{{ demande.employe.prenom }} {{ demande.employe.nom }}</td>
                        <td style="padding: 16px 8px; vertical-align: middle;">{{ demande.employe.Département }}</td>
                        <td style="padding: 16px 8px; vertical-align: middle; color: #0066cc;">{{ demande.get_materiel_display }}</td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle;">{{ demande.date_demande|date:"d/m/Y H:i" }}</td>
                        <td style="padding: 16px 8px; vertical-align: middle; font-size: 14px; color: #666;">{{ demande.commentaires|default:"Aucun commentaire" }}</td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle;">
                            <div class="action-buttons">
                                <button aria-label="Approuver la demande" class="btn-valider-demande" data-demande-id="{{ demande.id_demande }}" data-action="approuver" style="margin: 0 2px;">
                                    <i class="fas fa-check"></i> Approuver
                                </button>
                                <button aria-label="Refuser la demande" class="btn-refuser-demande" data-demande-id="{{ demande.id_demande }}" data-action="refuser" style="margin: 0 2px;">
                                    <i class="fas fa-times"></i> Refuser
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" style="text-align: center; color: #888; padding: 30px;">
                            Aucune demande de périphérique en attente
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Historique des validations -->
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Historique des validations</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #f8f9fa;">
                        <th style="width: 18%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Employé</th>
                        <th style="width: 15%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Matériel</th>
                        <th style="width: 12%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Statut</th>
                        <th style="width: 15%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Date de validation</th>
                        <th style="width: 18%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Traité par</th>
                        <th style="width: 22%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Commentaires</th>
                    </tr>
                </thead>
                <tbody>
                    {% for demande in demandes_peripheriques_traitees %}
                    <tr style="border-bottom: 1px solid #f0f0f0;">
                        <td style="padding: 16px 8px; vertical-align: middle; font-weight: 500;">{{ demande.employe.prenom }} {{ demande.employe.nom }}</td>
                        <td style="padding: 16px 8px; vertical-align: middle; color: #0066cc;">{{ demande.get_materiel_display }}</td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle;">
                            <span class="{{ demande.get_statut_display_class }}" style="padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                {{ demande.get_statut_display }}
                            </span>
                        </td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle;">{{ demande.date_modification|date:"d/m/Y H:i" }}</td>
                        <td style="padding: 16px 8px; vertical-align: middle;">
                            {% if demande.traite_par %}
                                {{ demande.traite_par.prenom }} {{ demande.traite_par.nom }}
                            {% else %}
                                <span style="color: #999;">-</span>
                            {% endif %}
                        </td>
                        <td style="padding: 16px 8px; vertical-align: middle; font-size: 14px; color: #666;">{{ demande.commentaires|default:"-" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" style="text-align: center; color: #888; padding: 30px;">
                            Aucune validation effectuée
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Vue Envoi des caractéristiques -->
<div id="Envoi-view" class="hidden">
    <div class="flex justify-between items-center mb-8">
        <h2>Envoi des caractéristiques</h2>
        <button aria-label="Envoyer Caractéristiques" id="send-characteristics-btn" class="btn-ajouter-manuel">
            <i class="fas fa-paper-plane"></i> Envoyer Caractéristiques
        </button>
    </div>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Historique des envois</h3>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Marque</th>
                        <th>Modèle</th>
                        <th>Processeur</th>
                        <th>RAM</th>
                        <th>Disque Dur</th>
                        <th>Envoyeur</th>
                        <th>Employé Concerné</th>
                        <th>Date d'envoi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for caracteristique in caracteristiques_envoyees %}
                    <tr data-pc-id="{{ pc.id_attribue }}">
                        <td>{{ caracteristique.marque }}</td>
                        <td>{{ caracteristique.modele }}</td>
                        <td>{{ caracteristique.processeur }}</td>
                        <td>{{ caracteristique.ram }}</td>
                        <td>{{ caracteristique.disque_dur }}</td>
                        <td>{{ caracteristique.envoyeur.prenom }} {{ caracteristique.envoyeur.nom }}</td>
                        <td>{{ caracteristique.employe_concerne.prenom }} {{ caracteristique.employe_concerne.nom }}</td>
                        <td>{{ caracteristique.date_envoi|date:"d M Y H:i" }}</td>
                    </tr>
                    {% empty %}
                    <tr data-pc-id="{{ pc.pk }}">
                        <td colspan="8">Aucune caractéristique envoyée.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Vue Caractéristiques reçues -->
<div id="received-characteristics-view" class="hidden">
    <h2>Caractéristiques reçues</h2>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Historique des caractéristiques reçues</h3>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Marque</th>
                        <th>Modèle</th>
                        <th>Processeur</th>
                        <th>RAM</th>
                        <th>Disque Dur</th>
                        <th>Envoyeur</th>
                        <th>Employé Concerné</th>
                        <th>Date d'envoi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for caracteristique in caracteristiques_envoyees %}
                    <tr>
                        <td>{{ caracteristique.marque }}</td>
                        <td>{{ caracteristique.modele }}</td>
                        <td>{{ caracteristique.processeur }}</td>
                        <td>{{ caracteristique.ram }}</td>
                        <td>{{ caracteristique.disque_dur }}</td>
                        <td>{{ caracteristique.envoyeur.prenom }} {{ caracteristique.envoyeur.nom }}</td>
                        <td>{{ caracteristique.employe_concerne.prenom }} {{ caracteristique.employe_concerne.nom }}</td>
                        <td>{{ caracteristique.date_envoi|date:"d M Y H:i" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8">Aucune caractéristique envoyée.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Vue Attribution -->
<div id="attribuer-view" class="hidden">
    <div class="flex justify-between items-center mb-8">
        <h2>Attribution</h2>
        <button aria-label="Attribuer un PC" id="assign-pc-btn" class="btn-ajouter-manuel">
            <i class="fas fa-plus"></i> Attribuer un ordinateur
        </button>
    </div>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Historique des attributions</h3>
                <i class='bx bx-search' title="Rechercher"></i>
                <i class='bx bx-filter' title="Filtrer"></i>
            </div>
            <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background-color: #f8f9fa;">
                                <th style="width: 15%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Nom</th>
                                <th style="width: 15%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Prénom</th>
                                <th style="width: 15%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Marque PC</th>
                                <th style="width: 15%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Modèle PC</th>
                                <th style="width: 20%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">N° Série PC</th>
                                <th style="width: 12%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Date Attribution</th>
                                <th style="width: 8%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for attribution in pcs_attribues %}
                            <tr data-attribution-id="{{ attribution.pk }}" style="border-bottom: 1px solid #f0f0f0;">
                                <td style="padding: 34px 16px; vertical-align: middle; font-weight: 500;">{{ attribution.employe.nom }}</td>
                                <td style="padding: 16px 8px; vertical-align: middle; font-weight: 500;">{{ attribution.employe.prenom }}</td>
                                <td style="padding: 16px 8px; vertical-align: middle;">{{ attribution.marque }}</td>
                                <td style="padding: 16px 8px; vertical-align: middle;">{{ attribution.modele }}</td>
                                <td style="padding: 16px 8px; vertical-align: middle; font-family: monospace; font-size: 13px;">{{ attribution.numero_serie }}</td>	
                                <td style="padding: 16px 8px; text-align: center; vertical-align: middle;">{{ attribution.date_attribution|date:"d/m/Y" }}</td>
                                <td style="padding: 16px 8px; text-align: center; vertical-align: middle;">
                                    <div class="action-buttons" style="display: inline-flex; align-items: center; gap: 6px;">
                                        <button class="btn-modifier btn-modifier-attribution" aria-label="Modifier l'attribution" title="Modifier" style="margin: 0 2px;">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-supprimer btn-supprimer-attribution" aria-label="Supprimer l'attribution" title="Supprimer" style="margin: 0 2px;">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                        <button aria-label="Bordereau" class="btn-bordereau" data-attribution-id="{{ attribution.pk }}" data-telephone="{{ attribution.employe.telephone }}" data-email="{{ attribution.employe.email }}" data-employe-id="{{ attribution.employe.pk }}" style="background-color: #17a2b8; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">Bordereau</button>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 30px; color: #888;">Aucun ordinateur attribué.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Vue Administration -->
<div id="administration-view" class="hidden">
    <h2>Administration</h2>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Gestion des logins / rôles</h3>
                <i class='bx bx-search' title="Rechercher"></i>
                <i class='bx bx-filter' title="Filtrer"></i>
            </div>

            <!-- Formulaire d’ajout / mise à jour -->
            <form method="post" action="" class="no-print"
                  style="display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end; margin: 12px 0; background:#f9fafb; border:1px solid #e5e7eb; border-radius:10px; padding:14px;">
                {% csrf_token %}
                <div style="display:flex; flex-direction:column; gap:6px; min-width:240px; flex:1;">
                    <label for="lmLogin" style="font-size:12px; color:#6b7280; font-weight:600;">Login</label>
                    <input id="lmLogin" name="login" type="text" placeholder="ex: a.kao"
                           required
                           style="height:40px; padding:0 12px; border:1px solid #d1d5db; border-radius:8px; outline:none; font-size:14px;">
                </div>

                <div style="display:flex; flex-direction:column; gap:6px; min-width:220px;">
                    <label for="lmRole" style="font-size:12px; color:#6b7280; font-weight:600;">Rôle</label>
                    <select id="lmRole" name="fonction" required
                            style="height:40px; padding:0 12px; border:1px solid #d1d5db; border-radius:8px; outline:none; font-size:14px; background:#fff;">
                        <option value="admin">admin</option>
                        <option value="DOT">DOT</option>
                        <option value="RDOT">RDOT</option>
                        <option value="DCH">DCH</option>
                        <option value="MG">MG</option>
                        <option value="RMG">RMG</option>
                        <option value="DAF">DAF</option>
                        <option value="Employe" selected>Employe</option>
                    </select>
                </div>

                <div style="display:flex; gap:10px;">
                    <button type="submit" class="btn-ajouter-manuel" aria-label="Enregistrer le mapping"
                            style="height:40px; padding:0 16px;">
                        Enregistrer
                    </button>
                </div>
            </form>

            <!-- Tableau des mappings -->
            <div style="overflow-x:auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="width: 40%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Login</th>
                            <th style="width: 40%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Rôle</th>
                            <th style="width: 20%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #f0f0f0;">
                            <td style="padding: 14px 8px; vertical-align: middle; font-weight: 500;"></td>
                            <td style="padding: 10px 8px; vertical-align: middle;">
                                <form method="post" action="" style="display:flex; gap:8px; align-items:center;">
                                    {% csrf_token %}
                                    <select name="fonction"
                                            style="height:36px; padding:0 12px; border:1px solid #d1d5db; border-radius:8px; outline:none; font-size:14px; background:#fff;">
                                        <option value="admin" >admin</option>
                                        <option value="DOT" >DOT</option>
                                        <option value="RDOT" >RDOT</option>
                                        <option value="DCH" >DCH</option>
                                        <option value="MG" >MG</option>
                                        <option value="RMG" >RMG</option>
                                        <option value="DAF" >DAF</option>
                                        <option value="Employe" >Employe</option>
                                    </select>
                                    <button type="submit" class="btn-modifier" aria-label="Mettre à jour" title="Mettre à jour"
                                            style="margin:0 2px;"><i class="fas fa-save"></i></button>
                                </form>
                            </td>
                            <td style="padding: 10px 8px; text-align: center; vertical-align: middle;">
                                <form method="post" action=""  style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn-supprimer" aria-label="Supprimer" title="Supprimer" onclick="return showNotification('Suppression réussie');" style="margin:0 2px;">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3" style="text-align:center; color:#888; padding:30px;">Aucun mapping défini.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div> 

<!-- Vue Matériel Perdu -->
<div id="materiel_perdu-view" class="hidden">
    <h1>Matériel Perdu</h1>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Ordinateur volé ou perdu</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>
            <!-- Récapitulatif de l'ordinateur attribué -->
            <div id="mpPcRecap" style="margin: 10px 0 16px; padding: 12px 14px; border: 1px solid #e5e7eb; border-radius: 8px; background: #fafafa;">
                <div style="font-weight:600; margin-bottom:8px; color:#333;">Votre ordinateur</div>
                <div id="mpNoPcMessage" style="color:#666; font-size:14px; display:none;">Aucun ordinateur attribué trouvé pour votre compte.</div>
                <div id="mpPcInfo" style="display:flex; flex-wrap:wrap; gap:10px; align-items:center;" class="table-data">
                    <div><span style="color:#666;">Marque:</span> <span id="mpPcMarque" style="font-weight:600;">-</span></div>
                    <div><span style="color:#666;">Modèle:</span> <span id="mpPcModele" style="font-weight:600;">-</span></div>
                    <div><span style="color:#666;">N° Série:</span> <span id="mpPcSerie" style="font-weight:600;">-</span></div>
                </div>
            </div>
            <form id="declarationMaterielPerduForm" method="post" action="{% url 'declarer_materiel_perdu' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="commentairesmatperdu">Commentaires additionnels (optionnel):</label>
                    <textarea id="commentairesmatperdu" name="commentaires" rows="6" style="width:100%; min-height:160px; padding:12px 14px; border:1px solid #d0d0d0; border-radius:8px; resize:vertical; font-size:14px; line-height:1.4;" placeholder="Ajoutez des informations complémentaires si nécessaire..."></textarea>
                </div>
                <div class="form-group">
                    <label for="date_perte">Date de perte:</label>
                    <input type="date" id="date_perte" name="date_perte" required>
                </div>
                <button type="submit" class="btn-ajouter-manuel">Déclarer</button>
            </form>
        </div>
    </div>
</div>



<!-- Vue Bordereau -->
<div id="bordereau-view" class="hidden">
    <h1>Mon Bordereau de Livraison</h1>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Détails du bordereau</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>

            <!-- Infos Employé -->
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Nom</th>
                        <th>Prénom</th>
                        <th>Filiale</th>
                        <th>Téléphone</th>
                    </tr>
                </thead>
                <tbody>
                    {% for b in bordereaux %}
                    <tr>
                        <td>{{ b.date_creation|date:"d/m/Y" }}</td>
                        <td>{{ b.employe.nom }}</td>
                        <td>{{ b.employe.prenom }}</td>
                        <td>ORAGROUP</td>
                        <td>{{ b.employe.telephone }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5">Aucun bordereau disponible.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Infos Matériel -->
            <table style="margin-top: 20px;">
                <thead>
                    <tr>
                        <th>N°</th>
                        <th>Numéro de série</th>
                        <th>Description</th>
                        <th>Quantité</th>
                    </tr>
                </thead>
                <tbody>
                    {% if bordereaux %}
                        {% for b in bordereaux %}
                            <!-- Ligne principale (PC) -->
                            <tr>
                                <td>1</td>
                                <td>{{ b.numero_serie_pc }}</td>
                                <td>{{ b.description_pc }}</td>
                                <td>1</td>
                            </tr>
                            <!-- Lignes supplémentaires (matériels) -->
                            {% for m in b.materiels.all %}
                                <tr>
                                    <td>{{ forloop.counter|add:"1" }}</td>
                                    <td>{{ m.numero_serie }}</td>
                                    <td>{% if m.description %}{{ m.description }}{% else %}{{ m.materiel }}{% endif %}</td>
                                    <td>{{ m.quantite }}</td>
                                </tr>
                            {% empty %}
                                {# Aucun matériel additionnel #}
                            {% endfor %}
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4">Aucun matériel associé.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>

            <!-- Politique -->
            <div class="politique-box">
                <a href="{% url 'politique_confidentialite' %}"><h2> Politique de Confidentialité et d'Utilisation</h2></a>
                <p style="max-width:860px; margin:14px auto 0; font-size:14px; line-height:1.55; text-align:justify; word-wrap:break-word; overflow-wrap:break-word; hyphens:auto; padding:0 8px; color:#333;">
                    En acceptant ce bordereau, vous reconnaissez avoir pris connaissance et accepté les termes de notre politique de confidentialité et d'utilisation des équipements. 
                </p>
                <p style="max-width:860px; margin:14px auto 0; font-size:14px; line-height:1.55; text-align:justify; word-wrap:break-word; overflow-wrap:break-word; hyphens:auto; padding:0 8px; color:#333;">
                    Cela inclut notamment : la gestion et la protection des données personnelles, l'utilisation appropriée et responsable des ressources informatiques de l'entreprise,
                <p style="max-width:860px; margin:14px auto 0; font-size:14px; line-height:1.55; text-align:justify; word-wrap:break-word; overflow-wrap:break-word; hyphens:auto; padding:0 8px; color:#333;">
                    ainsi que vos engagements en matière de sécurité, de conservation et de restitution du matériel.
                </p>
                <p style="max-width:860px; margin:14px auto 0; font-size:14px; line-height:1.55; text-align:justify; word-wrap:break-word; overflow-wrap:break-word; hyphens:auto; padding:0 8px; color:#333;">
                    <span style="display:inline-block; margin-top:6px;">Toute utilisation non conforme ou négligente peut engager votre responsabilité conformément aux procédures internes.</span>
                </p>
                <label class="checkbox-label">
                    <input type="checkbox" id="acceptCheckbox">
                    J'ai lu et j'accepte les termes du bordereau et la politique de confidentialité.
                </label>
            </div>

            <!-- Bouton -->
            <div style="text-align: center; margin-top: 20px;">
                {% for b in bordereaux %}
                    {% if b.statut == 'lu et accepté' %}
                        <button aria-label="Bordereau accepté" class="accept-bordereau-btn" disabled style="background-color: #28a745;">
                            Bordereau accepté
                        </button>
                        <p class="message-bordereau-accept" style="display: block; color: #28a745; font-weight: bold; margin-top: 10px;">
                            Bordereau lu et accepté le {{ b.date_statut|date:"d/m/Y à H:i" }}
                        </p>
                    {% else %}
                        <button aria-label="Marquer comme Lu et Accepté" id="acceptBordereauBtn" class="btn-Envoyer-Demande accept-bordereau-btn" disabled>
                            Marquer comme Lu et Accepté
                        </button>
                        <p id="messageBordereauAccept" class="accepted-message message-bordereau-accept" style="display: none;"></p>
                    {% endif %}
                {% empty %}
                    <button aria-label="Marquer comme Lu et Accepté" id="acceptBordereauBtn" class="btn-Envoyer-Demande accept-bordereau-btn" disabled>
                        Marquer comme Lu et Accepté
                    </button>
                    <p id="messageBordereauAccept" class="accepted-message message-bordereau-accept" style="display: none;"></p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Vue Les demandes -->
<div id="lesdemandes-view" class="hidden">
    <h2>Les Demandes</h2>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Demandes d'achat</h3>
                <i class="bx bx-search"></i>
                <i class="bx bx-filter"></i>
            </div>
            <div style="overflow-x:auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Prénom</th>
                            <th>Marque</th>
                            <th>Modèle</th>
                            <th>Date d'achat</th>
                            <th>Date d'attribution</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pc in pcs_attribues %}
                        {% if pc.status == "en attente" %}
                        <tr data-pc-id="{{ pc.pk }}">
                            <td>{{ pc.employe.nom }}</td>
                            <td>{{ pc.employe.prenom }}</td>
                            <td>{{ pc.marque }}</td>
                            <td>{{ pc.modele }}</td>
                            <td>{{ pc.date_achat|date:"Y-m-d" }}</td>
                            <td>{{ pc.date_attribution|date:"Y-m-d" }}</td>
                            <td>
                                <button aria-label="Valider la demande" class="action-btn-demande">Valider</button>
                            </td>
                            <td>
                                <button aria-label="Refuser la demande" class="action-btn-demande">Refuser</button>
                            </td>
                        </tr>
                        {% endif %}
                        {% empty %}
                        <tr>
                            <td colspan="9" style="text-align:center; color:#888; padding:30px;">Aucune demande de rachat.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Vue Restituer -->
<div id="Restituer-view" class="hidden">
    <h1>Restituer votre ordinateur</h1>
    
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Informations de restitution</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>
            <form id="restituerPcForm" method="post" action="{% url 'restituer_pc' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="restituerEmploye">Employé:</label>
                    <input type="text" id="restituerEmploye" value="{% if connected_user %}{{ connected_user.prenom }} {{ connected_user.nom }}{% endif %}" readonly>
                </div>
                
                <div class="form-group">
                    <label for="restituerMotif">Motif de restitution:</label>
                    <select id="restituerMotif" name="motif" required>
                        <option value="" disabled selected>Sélectionner un motif</option>
                        <option value="Fin de contrat">Fin de contrat</option>
                        <option value="Changement de poste">Changement de poste</option>
                        <option value="Démission">Démission</option>
                        <option value="Retraite">Retraite</option>
                        <option value="Mutation">Mutation</option>
                        <option value="Défaillance matérielle">Défaillance matérielle</option>
                        <option value="Autre">Autre</option>
                    </select>
                </div>

                <div class="form-group" id="autreMotifGroup" style="display: none;">
                    <label for="autreMotif">Précisez le motif:</label>
                    <textarea id="autreMotif" name="autre_motif" rows="3" placeholder="Veuillez préciser le motif de restitution..."></textarea>
                </div>

                <div class="form-group">
                    <label for="dateRestitution">Date de restitution prévue:</label>
                    <input type="date" id="dateRestitution" name="date_restitution" required>
                </div>

                <div class="form-group">
                    <label for="commentairesRestitution">Commentaires additionnels (optionnel):</label>
                    <textarea id="commentairesRestitution" name="commentaires" rows="6" style="width:100%; min-height:160px; padding:12px 14px; border:1px solid #d0d0d0; border-radius:8px; resize:vertical; font-size:14px; line-height:1.4;" placeholder="Ajoutez des informations complémentaires si nécessaire..."></textarea>
                </div>

                <div class="form-group" style="display:flex; align-items:flex-start; gap:10px; margin-top:10px;">
                    <input type="checkbox" id="confirmerRestitution" name="confirmer" required style="margin-top:4px;">
                    <label for="confirmerRestitution" style="cursor:pointer; line-height:1.4; font-size:14px;">
                        Je confirme vouloir restituer cet ordinateur et comprends que cette action est irréversible.
                    </label>
                </div>

                <button aria-label="Restituer le PC" type="submit" class="btn-restituer">
                    <i class="fas fa-undo"></i> Restituer l'ordinateur
                </button>
            </form>
        </div>
    </div>

    <!-- Script pour gérer l'activation du bouton -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const confirmCheckbox = document.getElementById('confirmerRestitution');
            const submitButton = document.querySelector('.btn-restituer');
            
            if (confirmCheckbox && submitButton) {
                // Initialiser le bouton comme désactivé
                submitButton.disabled = true;
                
                // Activer/désactiver le bouton selon la checkbox
                confirmCheckbox.addEventListener('change', function() {
                    submitButton.disabled = !this.checked;
                });
            }
        });
    </script>

    <!-- Script de test pour débugger la restitution -->
    <script>
        function testRestitutionElements() {
            const elements = {
                'restituerPcForm': document.getElementById('restituerPcForm'),
                'confirmerRestitution': document.getElementById('confirmerRestitution'),
                'btn-restituer': document.querySelector('.btn-restituer'),
                'restituerMotif': document.getElementById('restituerMotif'),
                'autreMotifGroup': document.getElementById('autreMotifGroup')
            };
            
           
            
            return elements;
        }
        
        // Gestionnaire pour afficher/masquer le champ "Autre motif"
        document.addEventListener('DOMContentLoaded', function() {
            const motifSelect = document.getElementById('restituerMotif');
            const autreMotifGroup = document.getElementById('autreMotifGroup');
            
            if (motifSelect && autreMotifGroup) {
                motifSelect.addEventListener('change', function() {
                    if (this.value === 'Autre') {
                        autreMotifGroup.style.display = 'block';
                    } else {
                        autreMotifGroup.style.display = 'none';
                    }
                });
            }
        });
    </script>

    <!-- Historique des restitutions -->
    

    <p id="noPcRestitutionMessage" class="hidden" style="text-align: center; margin-top: 20px; color: #555;">
        Aucun ordinateur attribué disponible pour la restitution.
    </p>
</div>

<!-- Vue Racheter -->
<div id="Racheter-view" class="hidden">
    <h1>Acheter votre ordinateur</h1>
    <div class="table-data">
        <div class="order">
            <div class="head">
                <h3>Votre ordinateur</h3>
                <i class='bx bx-search'></i>
                <i class='bx bx-filter'></i>
            </div>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #f8f9fa;">
                        <th style="width: 12%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Marque</th>
                        <th style="width: 12%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Modèle</th>
                        <th style="width: 8%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">RAM</th>
                        <th style="width: 12%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Disque dur</th>
                        <th style="width: 15%; padding: 12px 8px; text-align: left; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Processeur</th>
                        <th style="width: 11%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Date achat</th>
                        <th style="width: 11%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Date attribution</th>
                        <th style="width: 10%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Statut</th>
                        <th style="width: 9%; padding: 12px 8px; text-align: center; border-bottom: 2px solid #e0e0e0; font-weight: 600;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="racheterPcRow" style="border-bottom: 1px solid #f0f0f0;">
                        <td id="racheterMarque" style="padding: 16px 8px; vertical-align: middle; font-weight: 500;"></td>
                        <td id="racheterModele" style="padding: 16px 8px; vertical-align: middle;"></td>
                        <td id="racheterRam" style="padding: 16px 8px; text-align: center; vertical-align: middle; font-weight: 500;"></td>
                        <td id="racheterDisqueDur" style="padding: 16px 8px; text-align: center; vertical-align: middle;"></td>
                        <td id="racheterProcesseur" style="padding: 16px 8px; vertical-align: middle; font-size: 14px;"></td>
                        <td id="racheterDateAchat" style="padding: 16px 8px; text-align: center; vertical-align: middle;"></td>
                        <td id="racheterDateAttribution" style="padding: 16px 8px; text-align: center; vertical-align: middle;"></td>
                        <td id="racheterStatut" style="padding: 16px 8px; text-align: center; vertical-align: middle;">
                            {% if Pc_attribué.status == "en attente" %}
                                <span class="statut-en-attente">En attente</span>
                            {% elif Pc_attribué.status == "non envoyé" %}
                                <span class="statut-non-envoye">Non envoyé</span>
                            {% elif Pc_attribué.status == "validé" %}
                                <span class="statut-valide">Validé</span>
                            {% elif Pc_attribué.status == "refusé" %}
                                <span class="statut-refuse">Refusé</span>
                            {% else %}
                                <span>{{ Pc_attribué.status }}</span>
                            {% endif %}
                        </td>
                        <td style="padding: 16px 8px; text-align: center; vertical-align: middle;">  
                            <button aria-label="Envoyer demande de rachat" type="submit" class="btn-Envoyer-Demande_de_rachat" style="background-color: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">Envoyer demande</button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <p id="noPcAttributedMessage" class="hidden" style="text-align: center; margin-top: 20px; color: #555;">Aucun PC attribué à cet employé pour le rachat.</p>
        </div>
    </div>
</div>
<!-- Script amortissement manuel chargé globalement depuis dashboard.html -->